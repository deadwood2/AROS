import re
from jinja2 import Template

# Your new content template (same as before)
html_template = """
<h1>Unit Test Results<br><img style="width: 238px; height: 2px;" alt="spacer" src="/images/sidespacer.png"></h1>

<select name="unittests" id="unittests" onchange="show_unittests(this.value)">
{% for result in results %}
    <option value="{{ result }}">{{ result[:-15] }}</option>
{% endfor %}
</select>

<object style="float:left;height:100%;" width="100%" height="95vh" id="displayedtest" data="{{ activepage }}" type="text/html"></object>

<script type="text/javascript">
  function show_unittests(unittest) {
    document.getElementById("displayedtest").data = "/unittests/" + unittest;
  }
</script>
"""

# Assuming you have results and activepage defined before here
template = Template(html_template)
new_content = template.render(results=results, activepage=activepage)

# Read existing HTML
with open(html_path, 'r', encoding='utf-8') as f:
    html_text = f.read()

# Regex to replace content between <!-- before CONTENT --> and <!-- after CONTENT --> inside <main>...</main>
pattern = re.compile(
    r'(<main>.*?<!-- before CONTENT -->)(.*?)(<!-- after CONTENT -->.*?</main>)',
    re.DOTALL | re.IGNORECASE
)

# Replacement: keep before/after parts, insert new_content in the middle
updated_html = pattern.sub(r'\1\n\n' + new_content + r'\n\n\3', html_text)

# Write back updated HTML
with open(html_path, 'w', encoding='utf-8') as f:
    f.write(updated_html)
